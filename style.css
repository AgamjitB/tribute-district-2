// script.js (FINAL HARDER VERSION)

const puzzles = [
  { password: "chlorophyll", hint: "It's the green engine behind photosynthesis." },
  { password: "gravity", hint: "What keeps your feet on the ground?" },
  { password: "neuron", hint: "This fires signals inside your brain." },
  { password: "fusion", hint: "How stars generate their energy." },
  { password: "refraction", hint: "Why a straw looks bent in water." }
];

const facts = [
  "Your brain uses 20% of your body's energy — even at rest.",
  "There are more stars in the universe than grains of sand on Earth.",
  "You are made of stardust — literally.",
  "Lightning is hotter than the surface of the sun.",
  "Octopuses have 3 hearts and blue blood.",
  "In space, there’s no sound — no air means no noise.",
  "DNA in your body could stretch from Earth to Pluto and back… 17 times."
];

let currentAnswer = "";
let currentHint = "";
let egg1Complete = false;
let egg2Complete = false;

window.onload = function () {
  const puzzle = puzzles[Math.floor(Math.random() * puzzles.length)];
  currentAnswer = puzzle.password;
  currentHint = puzzle.hint;
  document.getElementById("puzzle-hint").textContent = "Hint: " + currentHint;

  const glitchText = document.getElementById("glitch-trigger");
  if (glitchText) {
    glitchText.style.color = egg2Complete ? "#55ff55" : "#777";
    if (egg2Complete) {
      glitchText.addEventListener("mouseenter", () => {
        hoverTimer = setTimeout(() => {
          document.getElementById("egg3-input").classList.add("show");
        }, 3000);
      });
      glitchText.addEventListener("mouseleave", () => clearTimeout(hoverTimer));
    }
  }
};

function showEggPopup() {
  const fact = facts[Math.floor(Math.random() * facts.length)];
  const popup = document.getElementById("egg-popup");
  document.getElementById("egg-text").innerHTML = fact + " (Hint: double click!)";
  popup.classList.remove("hidden");
  popup.onclick = () => {};
  popup.ondblclick = () => {
    const code = prompt("Type the code to continue:");
    if (code && code.toLowerCase() === "science123") {
      egg1Complete = true;
      alert("Easter Egg 1 unlocked!");
      window.location.href = "easter1.html";
    } else {
      alert("Wrong code. Try again.");
    }
  };
}

function checkAnswer() {
  if (!egg1Complete) {
    alert("You must unlock Science Surprise first.");
    return;
  }

  const input = document.getElementById("answer").value.toLowerCase();
  const result = document.getElementById("result");

  if (input === currentAnswer) {
    const riddle = prompt("Correct! Now answer: What’s between protons in an atom?");
    if (riddle && riddle.toLowerCase().includes("empty")) {
      egg2Complete = true;
      result.textContent = "You are correct!";
      result.style.color = "#00aa00";
      showSuccessToast();
      setTimeout(() => {
        window.location.href = "easter2.html";
      }, 2000);
    } else {
      result.textContent = "Close, but not quite. Think 'emptiness'.";
      result.style.color = "#cc0000";
    }
  } else {
    result.textContent = "Incorrect password. Try again.";
    result.style.color = "#cc0000";
  }
}

function revealDot() {
  document.getElementById("egg2").classList.add("visible");
}

function promptRiddle() {
  if (!egg1Complete) {
    alert("Unlock Science Surprise first.");
    return;
  }
  const answer = prompt("What has no mass, but occupies space?");
  if (answer && answer.toLowerCase().includes("vacuum")) {
    const second = prompt("What fills the space between protons?");
    if (second && second.toLowerCase().includes("nothing")) {
      egg2Complete = true;
      window.location.href = "easter2.html";
    } else {
      alert("Close. Try thinking of 'absence'.");
    }
  } else {
    alert("Incorrect. Hint: It's not air.");
  }
}

function showSuccessToast() {
  const toast = document.getElementById("success-toast");
  toast.classList.add("show");
  setTimeout(() => toast.classList.remove("show"), 4000);
}

function goToTeam() {
  window.location.href = "team.html";
}

function checkEgg3(event) {
  if (!egg2Complete) {
    alert("You need to complete the previous Easter Eggs first.");
    return;
  }
  if (event.key === "Enter") {
    const val = event.target.value.toLowerCase();
    if (val.includes("easter egg 3")) {
      window.location.href = "easter3.html";
    } else {
      alert("Try again. Hint: It's an Easter egg.");
    }
  }
}
